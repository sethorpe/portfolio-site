name: Playwright Tests

on:
  push:
    branches:
      - main  # Runs on pushes to main
  pull_request:
    branches:
      - main  # Runs on PRs to main

jobs:
  test:
    runs-on: ubuntu-latest
    timeout-minutes: 10  # Prevent long-hanging jobs

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: npm  # Caches npm dependencies to speed up CI runs

      - name: Install dependencies
        run: npm ci

      - name: Install Playwright Browsers
        run: npx playwright install --with-deps

      - name: Wait for deployment to be ready
        run: |
          n=0
          until curl =sSf $BASE_URL >/dev/null || [ $n -ge 20 ]; do
            echo " Waiting for $BASE_URL to be ready... (try $n)"
            n=$((n+1))
            sleep 10
          done
          echo "Deploymnt is ready!"
        env:
          BASE_URL: https://portfolio-site-git-add-ui-tests-seyi-thorpes-projects.vercel.app
          
      - name: Set Environment Variables
        run: echo "BASE_URL=https://portfolio-site-git-add-ui-tests-seyi-thorpes-projects.vercel.app/" >> $GITHUB_ENV  # Set the BASE_URL dynamically

      - name: Run Playwright tests
        run: npx playwright test
